# –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞—Å—Å–æ–≤–æ–º—É –∞–≥–µ–Ω—Ç—É (POS Agent Requirements)

## üìã –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è

–ö–∞—Å—Å–æ–≤—ã–π –∞–≥–µ–Ω—Ç ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª (–∫–∞—Å—Å—É) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ **Fiscal Monitor**.

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è Set Retail 10 –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö

- **–ò–Ω—Ç–µ—Ä–≤–∞–ª**: –ö–∞–∂–¥—ã–µ **60 —Å–µ–∫—É–Ω–¥** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
- **–î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω**: 30‚Äì300 —Å–µ–∫—É–Ω–¥ (0.5‚Äì5 –º–∏–Ω—É—Ç)
- **–ö—Ä–∏—Ç–∏—á–Ω–æ**: –ü—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç) —Å–µ—Ä–≤–µ—Ä –ø–æ–º–µ—Ç–∏—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª –∫–∞–∫ "STALE" (–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π)

### 2. –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

–ê–≥–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **JSON snapshot** (—Å–Ω–∏–º–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è) –Ω–∞ endpoint:

```
POST https://fiscaldrive.sbg.network/api/v1/fiscal/snapshot
Content-Type: application/json
```

**–í–∞–∂–Ω–æ**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è **–ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è** –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö. Endpoint –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞.

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON Snapshot

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|-----|----------|--------|
| `shopInn` | string | –ò–ù–ù –º–∞–≥–∞–∑–∏–Ω–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä) | `"311030320"` |
| `shopNumber` | string/int | –ù–æ–º–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ | `"1"` –∏–ª–∏ `1` |
| `shopName` | string | –ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ | `"Zahratun Qorako'l"` |
| `posNumber` | string/int | –ù–æ–º–µ—Ä –∫–∞—Å—Å—ã (—Ç–µ—Ä–º–∏–Ω–∞–ª–∞) | `"1"` –∏–ª–∏ `1` |
| `posIp` | string | IP-–∞–¥—Ä–µ—Å –∫–∞—Å—Å—ã | `"192.168.1.100"` |
| `fiscal` | object | –î–∞–Ω–Ω—ã–µ —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è | —Å–º. –Ω–∏–∂–µ |
| `alerts` | array | –ú–∞—Å—Å–∏–≤ –∞–ª–µ—Ä—Ç–æ–≤ (–ø—Ä–æ–±–ª–µ–º) | —Å–º. –Ω–∏–∂–µ |

### –û–±—ä–µ–∫—Ç `fiscal` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|-----|----------|--------|
| `fiscalStatus` | string | –°—Ç–∞—Ç—É—Å —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è | `"OK"`, `"ERROR"`, `"WARN"` |
| `lastCheck` | string | –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (ISO 8601 UTC) | `"2026-01-28T12:00:00.000Z"` |
| `receiptCount` | int | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤ –≤ —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ | `1500` |
| `fiscalUnsentCount` | int | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —á–µ–∫–æ–≤ –≤ –û–§–î | `5` |
| `zReportCount` | int | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Z-–æ—Ç—á–µ—Ç–æ–≤ | `120` |

### –û–±—ä–µ–∫—Ç `fiscal` (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|-----|----------|--------|
| `errorMessage` | string | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å) | `"–ö–∞—Å—Å–∞ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã"` |
| `receiptMaxCount` | int | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ë–º–∫–æ—Å—Ç—å –§–ü (—Ñ–∏—Å–∫–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏) | `20000` |
| `zReportMaxCount` | int | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Z-–æ—Ç—á–µ—Ç–æ–≤ | `1200` |
| `fmFillPercent` | float | –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –§–ü (%) | `7.5` |
| `zRemaining` | int | –û—Å—Ç–∞–≤—à–∏–µ—Å—è Z-–æ—Ç—á–µ—Ç—ã | `1080` |

### –ú–∞—Å—Å–∏–≤ `alerts` (–ø—Ä–æ–±–ª–µ–º—ã)

–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–Ω—É –ø—Ä–æ–±–ª–µ–º—É:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|-----|----------|--------|
| `severity` | string | –£—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏ | `"INFO"`, `"WARN"`, `"DANGER"`, `"CRITICAL"` |
| `message` | string | –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã | `"–ö–∞—Å—Å–∞ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã"` |
| `code` | string | –ö–æ–¥ –æ—à–∏–±–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | `"FISCAL_TIMEOUT"` |

**–£—Ä–æ–≤–Ω–∏ –≤–∞–∂–Ω–æ—Å—Ç–∏**:
- `INFO` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `WARN` ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- `DANGER` ‚Äî –æ–ø–∞—Å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è)
- `CRITICAL` ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞)

---

## üìù –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ JSON snapshot

```json
{
  "shopInn": "311030320",
  "shopNumber": "1",
  "shopName": "Zahratun Qorako'l",
  "posNumber": "1",
  "posIp": "192.168.1.100",
  "fiscal": {
    "fiscalStatus": "ERROR",
    "lastCheck": "2026-01-28T12:34:56.789Z",
    "errorMessage": "–ö–∞—Å—Å–∞ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã",
    "receiptCount": 1500,
    "receiptMaxCount": 20000,
    "fiscalUnsentCount": 5,
    "zReportCount": 120,
    "zReportMaxCount": 1200,
    "fmFillPercent": 7.5,
    "zRemaining": 1080
  },
  "alerts": [
    {
      "severity": "CRITICAL",
      "message": "–ö–∞—Å—Å–∞ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã",
      "code": "FISCAL_TIMEOUT"
    },
    {
      "severity": "WARN",
      "message": "–í—ã—Å–æ–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —á–µ–∫–æ–≤ –≤ –û–§–î",
      "code": "HIGH_UNSENT_COUNT"
    }
  ]
}
```

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω:
- –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (shopInn, shopNumber, shopName, posNumber, API endpoint)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è Set Retail 10
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ü–∏–∫–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 2. –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª

**–ö–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥** –∞–≥–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

1. **–û–ø—Ä–æ—Å —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è**
   - –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è (OK/ERROR/WARN)
   - –ü–æ–ª—É—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏: receiptCount, fiscalUnsentCount, zReportCount
   - –ü–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç—ã: receiptMaxCount, zReportMaxCount

2. **–ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è (timeout: 10 —Å–µ–∫—É–Ω–¥)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
     - –ú–æ–¥—É–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí `CRITICAL`
     - –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –§–ü > 90% ‚Üí `CRITICAL`
     - Z-–æ—Ç—á–µ—Ç–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å < 50 ‚Üí `DANGER`
     - –ù–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —á–µ–∫–æ–≤ > 100 ‚Üí `WARN`

3. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ snapshot**
   - –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON
   - –î–æ–±–∞–≤–∏—Ç—å timestamp –≤ UTC —Ñ–æ—Ä–º–∞—Ç–µ (ISO 8601)
   - –í—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (fmFillPercent, zRemaining)

4. **–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
   - POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `https://fiscaldrive.sbg.network/api/v1/fiscal/snapshot`
   - Timeout: 30 —Å–µ–∫—É–Ω–¥
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ: –∑–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –ª–æ–≥, –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π snapshot

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –§–∏—Å–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**
```json
{
  "shopInn": "311030320",
  "shopNumber": "1",
  "shopName": "Zahratun Qorako'l",
  "posNumber": "1",
  "posIp": "192.168.1.100",
  "fiscal": {
    "fiscalStatus": "ERROR",
    "lastCheck": "2026-01-28T12:34:56.789Z",
    "errorMessage": "Timeout: —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç",
    "receiptCount": null,
    "fiscalUnsentCount": null,
    "zReportCount": null
  },
  "alerts": [
    {
      "severity": "CRITICAL",
      "message": "–§–∏—Å–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã",
      "code": "FISCAL_TIMEOUT"
    }
  ]
}
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å snapshot –ª–æ–∫–∞–ª—å–Ω–æ
- –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
- –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∫–∞—Å—Å—ã!

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞

### ‚ùå –ù–ï–î–û–ü–£–°–¢–ò–ú–û

1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∫–∞—Å—Å—ã** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. **–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–∞—â–µ —á–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥** (–ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞)
3. **–ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–æ–æ–±—â–µ** (–∫–∞—Å—Å–∞ –±—É–¥–µ—Ç –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ STALE)
4. **–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (null –≤–º–µ—Å—Ç–æ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –±–µ–∑ alerts)

### ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û

1. **–í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å HTTP 204** ‚Äî —Å–µ—Ä–≤–µ—Ä –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 204 No Content
2. **–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å UTC timestamp** –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å camelCase** –¥–ª—è –ø–æ–ª–µ–π JSON (shopInn, –Ω–µ shop_inn)
4. **–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å alerts** –ø—Ä–∏ –ª—é–±—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
5. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è** –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª

---

## üìä –°–µ—Ä–≤–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ JSON –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
2. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ (string ‚Üí int –¥–ª—è shopNumber/posNumber)
3. **–û–±–æ–≥–∞—â–µ–Ω–∏–µ**: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ fmFillPercent, zRemaining (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã)
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è State Key**: `{shopInn}-{shopNumber}-{posNumber}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `311030320-1-1`)
5. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ Severity**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–∑ –≤—Å–µ—Ö alerts
6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: Upsert –≤ —Ç–∞–±–ª–∏—Ü—É `fiscal_last_state`
7. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –≤ `notification_queue`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ shopInn –≤ —Å–∏—Å—Ç–µ–º–µ:
- **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω**: `is_registered = true` ‚Üí –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø–æ—Ä—Ç–∞–ª–µ
- **–ù–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω**: `is_registered = false` ‚Üí –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –∞–¥–º–∏–Ω–∫–µ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π snapshot

```bash
curl -X POST https://fiscaldrive.sbg.network/api/v1/fiscal/snapshot \
  -H "Content-Type: application/json" \
  -d '{
    "shopInn": "311030320",
    "shopNumber": "1",
    "shopName": "Test Shop",
    "posNumber": "1",
    "posIp": "192.168.1.100",
    "fiscal": {
      "fiscalStatus": "OK",
      "lastCheck": "2026-01-28T12:00:00.000Z",
      "receiptCount": 1500,
      "fiscalUnsentCount": 0,
      "zReportCount": 120
    },
    "alerts": []
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç**:
```
HTTP/1.1 204 No Content
```

### –¢–µ—Å—Ç–æ–≤—ã–π snapshot —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–æ–π

```bash
curl -X POST https://fiscaldrive.sbg.network/api/v1/fiscal/snapshot \
  -H "Content-Type: application/json" \
  -d '{
    "shopInn": "311030320",
    "shopNumber": "1",
    "shopName": "Test Shop",
    "posNumber": "1",
    "posIp": "192.168.1.100",
    "fiscal": {
      "fiscalStatus": "ERROR",
      "lastCheck": "2026-01-28T12:00:00.000Z",
      "errorMessage": "–§–∏—Å–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç",
      "receiptCount": null,
      "fiscalUnsentCount": null,
      "zReportCount": null
    },
    "alerts": [
      {
        "severity": "CRITICAL",
        "message": "–§–∏—Å–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç",
        "code": "FISCAL_TIMEOUT"
      }
    ]
  }'
```

---

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —è–∑—ã–∫–∏/–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**:
- **Python 3.8+**: –ø—Ä–æ—Å—Ç–æ—Ç–∞, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ requests/schedule
- **Node.js 18+**: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, axios/node-cron
- **.NET 6+**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Windows-—Å–∏—Å—Ç–µ–º–∞–º–∏
- **Go 1.18+**: –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `agent-config.json`:

```json
{
  "shopInn": "311030320",
  "shopNumber": "1",
  "shopName": "Zahratun Qorako'l",
  "posNumber": "1",
  "fiscalModule": {
    "host": "localhost",
    "port": 6600,
    "timeout": 10000
  },
  "server": {
    "endpoint": "https://fiscaldrive.sbg.network/api/v1/fiscal/snapshot",
    "timeout": 30000,
    "retryAttempts": 3
  },
  "interval": 60000,
  "logging": {
    "enabled": true,
    "path": "/var/log/fiscal-agent/",
    "maxSize": "10MB",
    "retention": "7d"
  }
}
```

### –ü—Ä–∏–º–µ—Ä –ø—Å–µ–≤–¥–æ–∫–æ–¥–∞ (Python)

```python
import requests
import schedule
import time
import json
from datetime import datetime

CONFIG = load_config('agent-config.json')

def poll_fiscal_module():
    """–û–ø—Ä–æ—Å —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è Set Retail 10"""
    try:
        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –º–æ–¥—É–ª—é (COM-–ø–æ—Ä—Ç, TCP, USB –∏ —Ç.–¥.)
        fiscal = FiscalModule.connect(
            host=CONFIG['fiscalModule']['host'],
            port=CONFIG['fiscalModule']['port'],
            timeout=CONFIG['fiscalModule']['timeout']
        )
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        status = fiscal.get_status()
        counters = fiscal.get_counters()
        
        return {
            'fiscalStatus': 'OK' if status.ok else 'ERROR',
            'lastCheck': datetime.utcnow().isoformat() + 'Z',
            'receiptCount': counters.receipt_count,
            'fiscalUnsentCount': counters.unsent_count,
            'zReportCount': counters.z_report_count,
            'receiptMaxCount': 20000,  # –õ–∏–º–∏—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –º–æ–¥—É–ª—è
            'zReportMaxCount': 1200
        }
        
    except FiscalTimeout:
        return {
            'fiscalStatus': 'ERROR',
            'lastCheck': datetime.utcnow().isoformat() + 'Z',
            'errorMessage': 'Timeout: —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç'
        }

def analyze_alerts(fiscal_data):
    """–ê–Ω–∞–ª–∏–∑ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è alerts"""
    alerts = []
    
    if fiscal_data.get('fiscalStatus') == 'ERROR':
        alerts.append({
            'severity': 'CRITICAL',
            'message': fiscal_data.get('errorMessage', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'),
            'code': 'FISCAL_ERROR'
        })
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –§–ü
    if fiscal_data.get('receiptCount') and fiscal_data.get('receiptMaxCount'):
        fill_percent = (fiscal_data['receiptCount'] / fiscal_data['receiptMaxCount']) * 100
        if fill_percent > 90:
            alerts.append({
                'severity': 'CRITICAL',
                'message': f'–§–∏—Å–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ {fill_percent:.1f}%',
                'code': 'FM_FULL'
            })
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è Z-–æ—Ç—á–µ—Ç–æ–≤
    z_remaining = fiscal_data.get('zReportMaxCount', 0) - fiscal_data.get('zReportCount', 0)
    if z_remaining < 50:
        alerts.append({
            'severity': 'DANGER',
            'message': f'–û—Å—Ç–∞–ª–æ—Å—å Z-–æ—Ç—á–µ—Ç–æ–≤: {z_remaining}',
            'code': 'Z_REPORTS_LOW'
        })
    
    return alerts

def send_snapshot():
    """–û—Ç–ø—Ä–∞–≤–∫–∞ snapshot –Ω–∞ —Å–µ—Ä–≤–µ—Ä"""
    try:
        # –û–ø—Ä–æ—Å –º–æ–¥—É–ª—è
        fiscal_data = poll_fiscal_module()
        
        # –ê–Ω–∞–ª–∏–∑
        alerts = analyze_alerts(fiscal_data)
        
        # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ snapshot
        snapshot = {
            'shopInn': CONFIG['shopInn'],
            'shopNumber': CONFIG['shopNumber'],
            'shopName': CONFIG['shopName'],
            'posNumber': CONFIG['posNumber'],
            'posIp': get_local_ip(),
            'fiscal': fiscal_data,
            'alerts': alerts
        }
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞
        response = requests.post(
            CONFIG['server']['endpoint'],
            json=snapshot,
            timeout=CONFIG['server']['timeout'] / 1000
        )
        
        if response.status_code == 204:
            log_info(f"Snapshot sent successfully: {snapshot}")
        else:
            log_error(f"Unexpected response: {response.status_code}")
        
    except requests.RequestException as e:
        log_error(f"Failed to send snapshot: {e}")
        # –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º —Ä–∞–±–æ—Ç—É –∫–∞—Å—Å—ã!
    
    except Exception as e:
        log_error(f"Unexpected error: {e}")

# –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞
schedule.every(CONFIG['interval'] / 1000).seconds.do(send_snapshot)

log_info("Fiscal Agent started")
while True:
    schedule.run_pending()
    time.sleep(1)
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API**: https://github.com/FuzzyDi/fiscal-monitor-site  
**Endpoint**: https://fiscaldrive.sbg.network/api/v1/fiscal/snapshot  
**–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞**: https://fiscaldrive.sbg.network/admin/state

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞ | –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|--------|-----------|
| 2026-01-28 | 1.0 | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π |

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∞–≥–µ–Ω—Ç–∞

- [ ] –ê–≥–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è endpoint `/api/v1/fiscal/snapshot`
- [ ] JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- [ ] –ü–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç camelCase (shopInn, –Ω–µ shop_inn)
- [ ] Timestamp –≤ UTC —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601
- [ ] –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è alerts –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- [ ] –ê–≥–µ–Ω—Ç –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –∫–∞—Å—Å—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ timeout –æ—Ç —Ñ–∏—Å–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–º –º–æ–¥—É–ª–µ–º
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ production endpoint

---

**–£—Å–ø–µ—à–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! üöÄ**
