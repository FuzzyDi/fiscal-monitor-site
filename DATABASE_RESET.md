# üîÑ –°–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ!

–ï—Å–ª–∏ –≤—ã –æ–±–Ω–æ–≤–∏–ª–∏ —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã.

---

## ü™ü –î–ª—è Windows:

### –í–∞—Ä–∏–∞–Ω—Ç 1: PowerShell (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```powershell
.\reset-db.ps1
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Batch
```cmd
reset-db.bat
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í—Ä—É—á–Ω—É—é
```powershell
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# 2. –£–¥–∞–ª–∏—Ç—å volume –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker volume rm fiscal-monitor-site_postgres_data

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose up -d

# 4. –ü–æ–¥–æ–∂–¥–∞—Ç—å 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
docker-compose exec postgres psql -U postgres -d fiscal_monitor -c "\dt"
```

---

## ‚úÖ –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:

1. ‚è∏ –û—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
2. üóë –£–¥–∞–ª–∏—Ç—Å—è Docker volume —Å –¥–∞–Ω–Ω—ã–º–∏ PostgreSQL
3. üöÄ –ó–∞–ø—É—Å—Ç—è—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–Ω–æ–≤–æ
4. üî® PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ `backend/schema.sql`

---

## üìä –¢–∞–±–ª–∏—Ü—ã –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã:

### –û—Å–Ω–æ–≤–Ω—ã–µ (–±—ã–ª–∏ —Ä–∞–Ω—å—à–µ):
- `registrations` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–∞–Ω–∏–π
- `access_tokens` - –¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞
- `fiscal_last_state` - –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Å—Å
- `fiscal_events` - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π

### –ù–æ–≤—ã–µ (–¥–ª—è Telegram):
- `notification_subscription_requests` - –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É
- `notification_subscriptions` - –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
- `notification_preferences` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `telegram_connections` - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram
- `telegram_connect_codes` - –ö–æ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `notification_queue` - –û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `notification_history` - –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `notification_cooldowns` - –ê–Ω—Ç–∏-—Å–ø–∞–º –∑–∞—â–∏—Ç–∞

**–ò—Ç–æ–≥–æ:** 12 —Ç–∞–±–ª–∏—Ü

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞:

### –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î:
```powershell
docker-compose exec postgres psql -U postgres -d fiscal_monitor
```

### –í–Ω—É—Ç—Ä–∏ psql:
```sql
-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
\dt

-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
\d notification_subscriptions

-- –í—ã—Ö–æ–¥
\q
```

### –ò–ª–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:
```powershell
docker-compose exec postgres psql -U postgres -d fiscal_monitor -c "\dt"
```

---

## üìù –ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –Ω—É–∂–Ω–æ:

### 1. –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é (–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
```
http://localhost:8080/admin/login
‚Üí Registrations ‚Üí Add Registration
```

### 2. –°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
```
http://localhost:8080/admin/tokens
‚Üí Create Token
```

### 3. –í–æ–π—Ç–∏ –≤ –ø–æ—Ä—Ç–∞–ª –∫–ª–∏–µ–Ω—Ç–∞
```
http://localhost:8080/portal/login
‚Üí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
```

### 4. –ó–∞–ø—Ä–æ—Å–∏—Ç—å Telegram –ø–æ–¥–ø–∏—Å–∫—É
```
http://localhost:8080/portal/telegram
‚Üí –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—é
```

### 5. –û–¥–æ–±—Ä–∏—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
```
http://localhost:8080/admin/telegram
‚Üí –û–¥–æ–±—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å
```

---

## üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ú–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ **–¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã** –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:

```powershell
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
docker-compose exec -i postgres psql -U postgres -d fiscal_monitor

# –í–Ω—É—Ç—Ä–∏ psql –≤—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –≤—Ä—É—á–Ω—É—é
# (—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ backend/schema.sql —Å—Ç—Ä–æ–∫–∏ 94-269)
```

–ò–ª–∏ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª:
```powershell
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏
notepad telegram-migration.sql

# –í—ã–ø–æ–ª–Ω–∏—Ç—å
Get-Content telegram-migration.sql | docker-compose exec -T postgres psql -U postgres -d fiscal_monitor
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

- **Backup:** –ï—Å–ª–∏ –µ—Å—Ç—å –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å–¥–µ–ª–∞–π—Ç–µ backup –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º
- **Production:** –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–±—Ä–æ—Å –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ!
- **Development:** –≠—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

### Volume –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è:
```powershell
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ volumes
docker volume ls

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å force
docker volume rm -f fiscal-monitor-site_postgres_data

# –ò–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏ —É–¥–∞–ª–∏—Ç—å
docker-compose down -v
docker-compose up -d
```

### PostgreSQL –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```powershell
# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs postgres

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps postgres

# –†–µ—Å—Ç–∞—Ä—Ç
docker-compose restart postgres
```

### –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–ª–∏—Å—å:
```powershell
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å schema.sql –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec postgres ls -la /docker-entrypoint-initdb.d/

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é
docker-compose exec postgres psql -U postgres -d fiscal_monitor -f /docker-entrypoint-initdb.d/schema.sql
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

- **Schema:** `backend/schema.sql` (269 —Å—Ç—Ä–æ–∫)
- **Volume:** `fiscal-monitor-site_postgres_data`
- **–ë–∞–∑–∞:** `fiscal_monitor`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `postgres`
- **–ü–∞—Ä–æ–ª—å:** `postgres` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ docker-compose.yml)

---

**–ì–æ—Ç–æ–≤–æ! –ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –ë–î –≤—Å–µ Telegram —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç.**
